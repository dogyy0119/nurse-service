(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/ucenter/userinfo/userinfo"],{353:function(e,n,t){"use strict";(function(e,n){var i=t(4);t(26),t(27),t(34);i(t(25));var o=i(t(354));e.__webpack_require_UNI_MP_PLUGIN__=t,n(o.default)}).call(this,t(1)["default"],t(2)["createPage"])},354:function(e,n,t){"use strict";t.r(n);var i=t(355),o=t(357);for(var r in o)["default"].indexOf(r)<0&&function(e){t.d(n,e,(function(){return o[e]}))}(r);t(359);var u,s=t(54),a=Object(s["default"])(o["default"],i["render"],i["staticRenderFns"],!1,null,"5c7bc061",null,!1,i["components"],u);a.options.__file="pages/ucenter/userinfo/userinfo.vue",n["default"]=a.exports},355:function(e,n,t){"use strict";t.r(n);var i=t(356);t.d(n,"render",(function(){return i["render"]})),t.d(n,"staticRenderFns",(function(){return i["staticRenderFns"]})),t.d(n,"recyclableRender",(function(){return i["recyclableRender"]})),t.d(n,"components",(function(){return i["components"]}))},356:function(e,n,t){"use strict";var i;t.r(n),t.d(n,"render",(function(){return o})),t.d(n,"staticRenderFns",(function(){return u})),t.d(n,"recyclableRender",(function(){return r})),t.d(n,"components",(function(){return i}));try{i={uniList:function(){return t.e("uni_modules/uni-list/components/uni-list/uni-list").then(t.bind(null,601))},uniListItem:function(){return t.e("uni_modules/uni-list/components/uni-list-item/uni-list-item").then(t.bind(null,608))},cloudImage:function(){return t.e("components/cloud-image/cloud-image").then(t.bind(null,692))},uniIcons:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(t.bind(null,449))},uniPopup:function(){return t.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(t.bind(null,637))},uniPopupDialog:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog")]).then(t.bind(null,697))},uniBindMobileByMpWeixin:function(){return t.e("components/uni-bindMobileByMpWeixin/uni-bindMobileByMpWeixin").then(t.bind(null,709))}}}catch(s){if(-1===s.message.indexOf("Cannot find module")||-1===s.message.indexOf(".vue"))throw s;console.error(s.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var o=function(){var e=this,n=e.$createElement,t=(e._self._c,e.$t("userinfo.ProfilePhoto")),i=e.$t("userinfo.nickname"),o=e.userInfo.nickname||e.$t("userinfo.notSet"),r=e.$t("userinfo.phoneNumber"),u=e.userInfo.mobile||e.$t("userinfo.notSpecified"),s=e.$t("userinfo.setNickname"),a=e.$t("userinfo.setNicknamePlaceholder");e.$mp.data=Object.assign({},{$root:{m0:t,m1:i,m2:o,m3:r,m4:u,m5:s,m6:a}})},r=!1,u=[];o._withStripped=!0},357:function(e,n,t){"use strict";t.r(n);var i=t(358),o=t.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){t.d(n,e,(function(){return i[e]}))}(r);n["default"]=o.a},358:function(e,n,t){"use strict";(function(e,i){var o=t(4);Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=o(t(35)),u=o(t(37)),s=o(t(11)),a=t(49);function c(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?c(Object(t),!0).forEach((function(n){(0,s.default)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var f=e.database(),d=f.collection("uni-id-users"),p={data:function(){return{univerifyStyle:{authButton:{title:"本机号码一键绑定"},otherLoginButton:{title:"其他号码绑定"}}}},onLoad:function(){this.univerifyStyle.authButton.title=this.$t("userinfo.bindPhoneNumber"),this.univerifyStyle.otherLoginButton.title=this.$t("userinfo.bindOtherLogin"),i.setNavigationBarTitle({title:this.$t("userinfo.navigationBarTitle")})},computed:l(l({},(0,a.mapGetters)({userInfo:"user/info",login:"user/hasLogin"})),{},{avatar_file:function(){if(this.userInfo.avatar_file&&this.userInfo.avatar_file.url)return this.userInfo.avatar_file}}),methods:l(l({},(0,a.mapMutations)({setUserInfo:"user/login"})),{},{bindMobile:function(){this.$refs["uni-bindMobileByMpWeixin"].open()},univerify:function(){var n=this;i.login({provider:"univerify",univerifyStyle:this.univerifyStyle,success:function(){var t=(0,u.default)(r.default.mark((function t(o){return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log(o.authResult),e.callFunction({name:"uni-id-cf",data:{action:"bindMobileByUniverify",params:o.authResult},success:function(e){var t=e.result;console.log(t),0===t.code?(n.setUserInfo({mobile:t.mobile}),i.closeAuthView()):i.showModal({content:t.msg,showCancel:!1,complete:function(){i.closeAuthView()}})}});case 2:case"end":return t.stop()}}),t)})));function o(e){return t.apply(this,arguments)}return o}(),fail:function(e){console.log(e),"30002"!=e.code&&"30001"!=e.code||n.bindMobileBySmsCode()}})},bindMobileBySmsCode:function(){i.navigateTo({url:"/pages/ucenter/userinfo/bind-mobile/bind-mobile"})},setNickname:function(e){var n=this;console.log(e),e?(d.where("_id==$env.uid").update({nickname:e}).then((function(t){console.log(t),t.result.updated?(i.showToast({title:n.$t("common.updateSucceeded"),icon:"none"}),n.setUserInfo({nickname:e})):i.showToast({title:n.$t("userinfo.noChange"),icon:"none"})})),this.$refs.dialog.close()):this.$refs.dialog.open()},setAvatarFile:function(e){var n=this;i.showLoading({title:this.$t("userinfo.setting"),mask:!0}),d.where("_id==$env.uid").update({avatar_file:e}).then((function(t){console.log(t),e?i.showToast({icon:"none",title:n.$t("userinfo.setSucceeded")}):i.showToast({icon:"none",title:n.$t("userinfo.deleteSucceeded")}),n.setUserInfo({avatar_file:e})})).catch((function(e){i.showModal({content:e.message||n.$t("userinfo.requestFail"),showCancel:!1})})).finally((function(){i.hideLoading()}))},uploadAvatarImg:function(n){var t=this,o={quality:100,width:600,height:600,resize:!0};i.chooseImage({count:1,crop:o,success:function(){var n=(0,u.default)(r.default.mark((function n(u){var s,a,c,l,f,d;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return console.log(u),s=u.tempFiles[0],a={extname:s.path.split(".")[s.path.split(".").length-1]},c=u.tempFilePaths[0],n.next=4,new Promise((function(e){i.navigateTo({url:"/pages/ucenter/userinfo/cropImage?path="+c+"&options=".concat(JSON.stringify(o)),animationType:"fade-in",events:{success:function(n){e(n)}}})}));case 4:return c=n.sent,console.log(t.userInfo),l=t.userInfo._id+""+Date.now(),a.name=l,i.showLoading({title:t.$t("userinfo.uploading"),mask:!0}),n.next=11,e.uploadFile({filePath:c,cloudPath:l,fileType:"image"});case 11:f=n.sent,d=f.fileID,a.url=d,console.log({avatar_file:a}),i.hideLoading(),t.setAvatarFile(a);case 17:case"end":return n.stop()}}),n)})));function s(e){return n.apply(this,arguments)}return s}()})}})};n.default=p}).call(this,t(34)["default"],t(2)["default"])},359:function(e,n,t){"use strict";t.r(n);var i=t(360),o=t.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){t.d(n,e,(function(){return i[e]}))}(r);n["default"]=o.a},360:function(e,n,t){}},[[353,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/pages/ucenter/userinfo/userinfo.js.map